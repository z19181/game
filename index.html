<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>夜城挑战：夺取 PS5</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Rajdhani:wght@600;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --neon-gold: #ffd700;
        --neon-red: #ff003c;
        --neon-blue: #00f3ff;
        --bg-color: #050505;
        --glass: rgba(20, 20, 20, 0.95);
      }

      * {
        box-sizing: border-box;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        margin: 0;
        background: var(--bg-color);
        font-family: "Rajdhani", sans-serif;
        height: 100vh;
        overflow: hidden;
        color: white;
        display: flex;
        flex-direction: column;
      }

      /* 背景 */
      .bg-grid {
        position: absolute;
        top: 0;
        left: 0;
        width: 200%;
        height: 200%;
        background: linear-gradient(rgba(0, 243, 255, 0.1) 1px, transparent 1px),
          linear-gradient(90deg, rgba(0, 243, 255, 0.1) 1px, transparent 1px);
        background-size: 40px 40px;
        transform: perspective(500px) rotateX(60deg) translateY(-100px)
          translateZ(-200px);
        z-index: -2;
        opacity: 0.5;
      }

      /* 顶部 */
      .header-zone {
        padding: 10px 15px;
        z-index: 10;
      }
      .rank-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(0, 20, 40, 0.8);
        border: 1px solid var(--neon-blue);
        border-radius: 8px;
        padding: 10px;
        box-shadow: 0 0 15px rgba(0, 243, 255, 0.15);
      }
      .rank-value {
        font-family: "Orbitron";
        font-size: 1.5rem;
        color: white;
        text-shadow: 0 0 5px var(--neon-blue);
      }
      .prize-img-small {
        height: 50px;
        width: auto;
        filter: drop-shadow(0 0 5px var(--neon-blue));
      }

      /* 进度条 (12格) */
      .progress-track {
        display: flex;
        gap: 2px;
        padding: 5px 15px;
        margin-bottom: 5px;
      }
      .progress-dot {
        flex: 1;
        height: 8px;
        background: #333;
        border-radius: 2px;
      }
      .progress-dot.active {
        background: var(--neon-gold);
        box-shadow: 0 0 5px var(--neon-gold);
      }

      /* 数值条 */
      .stats-bar {
        display: flex;
        gap: 5px;
        padding: 0 15px;
        height: 6px;
        width: 100%;
      }
      .stat-pill {
        flex: 1;
        background: #222;
        border-radius: 3px;
        overflow: hidden;
      }
      .stat-fill {
        height: 100%;
        width: 50%;
        transition: width 0.3s;
      }

      /* 游戏卡片 */
      .game-area {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 10px;
        perspective: 1000px;
      }
      .card {
        width: 100%;
        max-width: 400px;
        height: 100%;
        max-height: 520px;
        background: var(--glass);
        border: 2px solid var(--neon-blue);
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        box-shadow: 0 0 30px rgba(0, 243, 255, 0.1);
      }
      .card-visual {
        flex: 3;
        position: relative;
        overflow: hidden;
        margin: 5px;
        border-radius: 8px;
        background: black;
      }
      .card-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        opacity: 0.9;
      }
      .card-text {
        flex: 2;
        padding: 15px;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      /* 按钮 */
      .controls {
        display: flex;
        gap: 10px;
        padding: 15px;
        width: 100%;
        max-width: 420px;
        margin: 0 auto;
      }
      .btn {
        flex: 1;
        padding: 20px;
        border: none;
        font-family: "Orbitron";
        font-weight: bold;
        font-size: 1rem;
        color: black;
        clip-path: polygon(
          10px 0,
          100% 0,
          100% calc(100% - 10px),
          calc(100% - 10px) 100%,
          0 100%,
          0 10px
        );
        cursor: pointer;
      }
      .btn-l {
        background: var(--neon-red);
        color: white;
      }
      .btn-r {
        background: var(--neon-blue);
        color: black;
      }
      .btn-pay {
        background: var(--neon-gold);
        color: black;
        width: 100%;
        margin-top: 15px;
        animation: pulse 1s infinite;
      }
      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
        100% {
          transform: scale(1);
        }
      }

      /* 通用弹窗 */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.98);
        z-index: 100;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 30px;
      }

      /* 输入框样式 */
      .input-group {
        width: 100%;
        margin: 10px 0;
        text-align: left;
      }
      .input-field {
        width: 100%;
        padding: 12px;
        background: #111;
        border: 1px solid var(--neon-blue);
        color: white;
        font-family: "Rajdhani";
        margin-top: 5px;
        outline: none;
      }

      /* 支付二维码模拟 */
      .qr-placeholder {
        width: 200px;
        height: 200px;
        background: white;
        margin: 20px auto;
        display: flex;
        justify-content: center;
        align-items: center;
        color: black;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="bg-grid"></div>

    <div class="header-zone">
      <div class="rank-card">
        <div>
          <div style="font-size: 0.7rem; color: #aaa">
            距离大奖还差
            <span
              id="weeks-left"
              style="color: var(--neon-gold); font-size: 1.2rem"
              >12</span
            >
            关
          </div>
          <div class="rank-value" id="rank-display">Level 0</div>
        </div>
        <img
          src="https://gmedia.playstation.com/is/image/SIEPDC/ps5-product-thumbnail-01-en-14sep21?$facebook$"
          class="prize-img-small"
        />
      </div>
    </div>

    <!-- 12级进度条 -->
    <div class="progress-track" id="progress-container">
      <!-- JS生成 -->
    </div>

    <div class="stats-bar">
      <div class="stat-pill">
        <div id="bar-1" class="stat-fill" style="background: #ffd700"></div>
      </div>
      <div class="stat-pill">
        <div id="bar-2" class="stat-fill" style="background: #ff4500"></div>
      </div>
      <div class="stat-pill">
        <div id="bar-3" class="stat-fill" style="background: #bc13fe"></div>
      </div>
      <div class="stat-pill">
        <div id="bar-4" class="stat-fill" style="background: #00f3ff"></div>
      </div>
    </div>

    <div class="game-area">
      <div class="card" id="game-card">
        <div class="card-visual">
          <img id="card-img" class="card-img" src="" alt="" />
        </div>
        <div class="card-text">
          <h2
            id="card-title"
            style="color: var(--neon-gold); margin-bottom: 10px"
          >
            LOADING...
          </h2>
          <p id="card-desc" style="color: #ddd; line-height: 1.4">...</p>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="btn btn-l" id="btn-l" onclick="makeChoice('left')">
        NO
      </button>
      <button class="btn btn-r" id="btn-r" onclick="makeChoice('right')">
        YES
      </button>
    </div>

    <!-- 失败/付费弹窗 -->
    <div class="modal" id="modal-fail">
      <h1 style="color: var(--neon-red); font-size: 2.5rem; margin: 0">
        差一点!
      </h1>
      <p style="color: #ccc; margin: 10px 0">
        你在第
        <span id="fail-level" style="color: white; font-size: 1.5rem">9</span>
        关倒下了
      </p>

      <div
        style="
          margin: 20px 0;
          border: 1px solid var(--neon-gold);
          padding: 15px;
          border-radius: 5px;
        "
      >
        <p style="color: var(--neon-gold); margin: 0; font-size: 1.1rem">
          距离领取 PS5 仅差
          <span id="fail-left" style="font-size: 1.5rem; font-weight: bold"
            >3</span
          >
          关
        </p>
      </div>

      <!-- 首次免费提示 -->
      <div id="free-play-btn" style="display: none; width: 100%">
        <button class="btn btn-r" onclick="restartGame()">
          免费再试一次 (剩余1次)
        </button>
      </div>

      <!-- 付费按钮 -->
      <div id="pay-btn-group" style="display: none; width: 100%">
        <p style="font-size: 0.8rem; color: #666">免费次数已用完</p>
        <button class="btn btn-pay" onclick="showPayment()">
          支付 ￥10.00 继续挑战
        </button>
      </div>
    </div>

    <!-- 支付界面 (模拟) -->
    <div class="modal" id="modal-payment">
      <h2 style="color: white">支付 10 元</h2>
      <div class="qr-placeholder">
        <img
          src="https://upload.wikimedia.org/wikipedia/commons/d/d0/QR_code_for_mobile_English_Wikipedia.svg"
          style="width: 100%; opacity: 0.8"
        />
        <!-- 实际使用时替换为你的收款码 -->
      </div>
      <p style="font-size: 0.8rem; color: #888">
        (模拟支付环境：点击下方按钮直接成功)
      </p>
      <button
        class="btn btn-r"
        style="margin-top: 20px"
        onclick="paymentSuccess()"
      >
        我已支付
      </button>
      <button
        class="btn btn-l"
        style="
          margin-top: 10px;
          background: transparent;
          border: 1px solid #333;
        "
        onclick="closePayment()"
      >
        取消
      </button>
    </div>

    <!-- 领奖表单 -->
    <div class="modal" id="modal-win">
      <img
        src="https://gmedia.playstation.com/is/image/SIEPDC/ps5-product-thumbnail-01-en-14sep21?$facebook$"
        style="width: 150px; margin-bottom: 10px"
      />
      <h1 style="color: var(--neon-gold)">挑战成功!</h1>
      <p style="font-size: 0.9rem; color: #ccc; margin-bottom: 20px">
        恭喜通关！请填写收货信息寄送奖品。
      </p>

      <div class="input-group">
        <input type="text" class="input-field" placeholder="姓名" />
        <input type="text" class="input-field" placeholder="手机号" />
        <input type="text" class="input-field" placeholder="详细收货地址" />
      </div>

      <button class="btn btn-pay" onclick="submitAddress()">提交领奖</button>
    </div>

    <script>
      // --- 核心配置 ---
      const TARGET_LEVEL = 12; // 12关
      let level = 0;
      let stats = [50, 50, 50, 50];
      let isFirstPlay = localStorage.getItem("hasPlayedFree") !== "true"; // 检查是否玩过

      // 事件库
      const events = [
        {
          t: "捡到钱包",
          d: "是否归还？",
          l: "归还",
          r: "私吞",
          el: [0, 5, 0, 5],
          er: [20, 0, 0, -20],
          img: "https://images.unsplash.com/photo-1621504450162-e1529e4d6749?q=80&w=600",
        },
        {
          t: "药剂推销",
          d: "喝下神秘药水？",
          l: "拒绝",
          r: "喝！",
          el: [0, 0, 0, 5],
          er: [-10, 10, 10, -10],
          img: "https://images.unsplash.com/photo-1614726365723-49cfae968c94?q=80&w=600",
        },
        {
          t: "黑客勒索",
          d: "支付赎金？",
          l: "给钱",
          r: "不给",
          el: [-20, 0, 0, 0],
          er: [0, -20, 0, -10],
          img: "https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?q=80&w=600",
        },
        {
          t: "深夜派对",
          d: "参加富豪派对？",
          l: "不去",
          r: "去",
          el: [0, -5, 0, 5],
          er: [10, 5, 10, -15],
          img: "https://images.unsplash.com/photo-1514525253440-b393452e2729?q=80&w=600",
        },
        {
          t: "街头斗殴",
          d: "帮忙吗？",
          l: "路过",
          r: "帮忙",
          el: [0, 0, 0, -5],
          er: [-10, 10, 0, 5],
          img: "https://images.unsplash.com/photo-1509557965875-b88c97052f0e?q=80&w=600",
        },
        {
          t: "机械改造",
          d: "安装非法义体？",
          l: "不要",
          r: "要强力",
          el: [0, 0, 0, 5],
          er: [-15, 10, 10, -20],
          img: "https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=600",
        },
      ];

      let currentEvent = {};

      function init() {
        level = 0;
        stats = [50, 50, 50, 50];
        document.getElementById("modal-fail").style.display = "none";
        document.getElementById("modal-win").style.display = "none";
        document.getElementById("modal-payment").style.display = "none";

        // 生成顶部进度点
        let dotsHtml = "";
        for (let i = 0; i < TARGET_LEVEL; i++)
          dotsHtml += `<div class="progress-dot" id="dot-${i}"></div>`;
        document.getElementById("progress-container").innerHTML = dotsHtml;

        updateUI();
        nextCard();
      }

      function updateUI() {
        // 更新数值条
        for (let i = 0; i < 4; i++) {
          let el = document.getElementById(`bar-${i + 1}`);
          el.style.width = stats[i] + "%";
          if (stats[i] < 15 || stats[i] > 85)
            el.style.boxShadow = "0 0 10px white";
          else el.style.boxShadow = "none";
        }

        // 更新文字和进度点
        document.getElementById("rank-display").innerText = `Level ${level}`;
        document.getElementById("weeks-left").innerText = TARGET_LEVEL - level;

        for (let i = 0; i < TARGET_LEVEL; i++) {
          let dot = document.getElementById(`dot-${i}`);
          if (i < level) dot.classList.add("active");
          else dot.classList.remove("active");
        }
      }

      function nextCard() {
        currentEvent = events[Math.floor(Math.random() * events.length)];
        document.getElementById("card-title").innerText = currentEvent.t;
        document.getElementById("card-desc").innerText = currentEvent.d;
        document.getElementById("btn-l").innerText = currentEvent.l;
        document.getElementById("btn-r").innerText = currentEvent.r;
        document.getElementById("card-img").src = currentEvent.img;
      }

      function makeChoice(side) {
        level++;
        let effects = side === "left" ? currentEvent.el : currentEvent.er;

        // --- 核心操控逻辑 ---
        let difficultyMult = 1;

        if (isFirstPlay) {
          // 新手保护期 (1-7关)：伤害减半，甚至加血，确保不死
          if (level <= 7) {
            difficultyMult = 0.5;
            // 强制修正：如果某个数值过低，反向加血
            for (let i = 0; i < 4; i++) if (stats[i] < 30) stats[i] += 15;
          }
          // 必死期 (8-10关)：伤害爆表，确保用户死在黎明前
          else if (level >= 8) {
            difficultyMult = 3.0;
            // 强制恶意干扰：直接扣除生命值较低的属性
            for (let i = 0; i < 4; i++) if (stats[i] < 50) stats[i] -= 20;
          }
        } else {
          // 付费用户：全程困难，但公平随机 (依然很难，保持0.01%概率)
          difficultyMult = 2.0;
        }

        for (let i = 0; i < 4; i++) {
          // 应用数值
          stats[i] += Math.floor(effects[i] * difficultyMult);
          // 随机波动
          stats[i] += Math.floor(Math.random() * 10) - 5;
          if (stats[i] > 100) stats[i] = 100;
          if (stats[i] < 0) stats[i] = 0;
        }

        updateUI();
        setTimeout(checkStatus, 200);
      }

      function checkStatus() {
        let dead = false;
        if (
          stats[0] <= 0 ||
          stats[1] <= 0 ||
          stats[2] >= 100 ||
          stats[3] <= 0 ||
          stats[3] >= 100
        )
          dead = true;

        if (dead) {
          showFailModal();
        } else if (level >= TARGET_LEVEL) {
          document.getElementById("modal-win").style.display = "flex";
        } else {
          nextCard();
        }
      }

      function showFailModal() {
        document.getElementById("modal-fail").style.display = "flex";
        document.getElementById("fail-level").innerText = level;
        document.getElementById("fail-left").innerText = TARGET_LEVEL - level;

        // 判断是否第一次玩
        if (isFirstPlay) {
          // 第一次：记录状态，显示"再试一次"（其实这里逻辑上已经是第一次结束了，看你想不想给第二次免费机会）
          // 根据需求描述："第一次免费...免费第一次后就需要支付"
          // 所以第一次死掉后，按钮应该变成支付
          localStorage.setItem("hasPlayedFree", "true");
          isFirstPlay = false; // 内存状态更新

          // 显示支付按钮（因为刚用完了免费机会）
          document.getElementById("free-play-btn").style.display = "none";
          document.getElementById("pay-btn-group").style.display = "block";
        } else {
          // 已经不是第一次了，直接显示支付
          document.getElementById("free-play-btn").style.display = "none";
          document.getElementById("pay-btn-group").style.display = "block";
        }
      }

      function showPayment() {
        document.getElementById("modal-payment").style.display = "flex";
      }

      function closePayment() {
        document.getElementById("modal-payment").style.display = "none";
      }

      function paymentSuccess() {
        // 模拟支付成功
        document.getElementById("modal-payment").style.display = "none";
        document.getElementById("modal-fail").style.display = "none";
        // 支付后重新开始
        init();
      }

      function restartGame() {
        // 这个函数一般只在逻辑需要"重置"时调用
        init();
      }

      function submitAddress() {
        let inputs = document.querySelectorAll(".input-field");
        if (inputs[0].value && inputs[1].value) {
          alert("提交成功！奖品将在7个工作日内寄出。");
          location.reload();
        } else {
          alert("请填写完整信息");
        }
      }

      // 启动检查
      // 如果是第一次进入页面，且localStorage没有记录，则视为免费用户
      // 初始化逻辑在 HTML 加载后自动运行
      init();
    </script>
  </body>
</html>
